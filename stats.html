<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Статистика реестра иноагентов</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	</head>
	<body>
		<nav class="navbar bg-body-tertiary">
			<div class="container-fluid">
				<span class="navbar-brand mb-0 h1"><img src="https://habrastorage.org/webt/a_/xt/c_/a_xtc_o6zp8oqpzkamwvuzlayfq.jpeg" alt="Logo" width="30" height="30" class="d-inline-block align-text-top"> Реестр иноагентов</span>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
				<div class="collapse navbar-collapse" id="navbarNav">
					<ul class="navbar-nav">
						<li class="nav-item"><a class="nav-link" href="index.html">Главная</a></li>
						<li class="nav-item"><a class="nav-link active" aria-current="page" href="stats.html">Статистика</a></li>
					</ul>
				</div>
			</div>
		</nav>
		<div class="container">
			<br>
			<div class="row">
				<center>
					<canvas aria-label="По типу агента" role="img" id="type"></canvas>
				</center>
			</div>
			<br>
			<br>
			<div class="row">
				<center>
					<canvas aria-label="Кол-во включений и исключений по годам" role="img" id="years"></canvas>
				</center>
			</div>
			<br>
		</div>
		<footer>
			<center>
				<br>
				&copy; 2023, li0ard, Министерство Юстиции РФ
				<br>
				<br>
			</center>
		</footer>
		<script type="text/javascript">
			//ff5722
			//00e676
			//1e88e5
			fetch(`https://raw.githubusercontent.com/li0ard/registry-of-foreign-agents/main/registry.json`)
			.then(res => res.json())
			.then(body => {
				let ul = body.filter(i => i.inn.length==10).length
				let fl = body.filter(i => i.inn.length==12).length
				let type = new Chart(document.getElementById('type'), {
					type: 'pie',
					data: {
						labels: ['Юридические лица', 'Физические лица', 'Прочее'],
						datasets: [{
							data: [ul, fl, body.length-(ul+fl)],
							backgroundColor: ['#ff5722', '#00e676', '#1e88e5'],
							borderWidth: 0.5 ,
							borderColor: '#ddd'
						}]
					},
					options: {
						plugins: {
							title: {
								display: true,
								text: 'По типу агента'
							},
							subtitle: {
								display: true,
								text: `Всего: ${body.length} записей`
							}
						}
					}
				});
				type.canvas.parentNode.style.height = '80vh';
				let years = new Chart(document.getElementById('years'), {
					type: "bar",
					data: {
						labels: ["2013","2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023"],
						datasets: [
							{
								label: 'Внесено',
								backgroundColor: ["#1e88e5"],
								data: [
									body.filter(i => i.dateIn.includes("2013")).length,
									body.filter(i => i.dateIn.includes("2014")).length,
									body.filter(i => i.dateIn.includes("2015")).length,
									body.filter(i => i.dateIn.includes("2016")).length,
									body.filter(i => i.dateIn.includes("2017")).length,
									body.filter(i => i.dateIn.includes("2018")).length,
									body.filter(i => i.dateIn.includes("2019")).length,
									body.filter(i => i.dateIn.includes("2020")).length,
									body.filter(i => i.dateIn.includes("2021")).length,
									body.filter(i => i.dateIn.includes("2022")).length,
									body.filter(i => i.dateIn.includes("2023")).length
								]
							},
							{
								label: 'Исключено',
								backgroundColor: "#ff5722",
								data: [
									body.filter(i => i.dateOut.includes("2013")).length,
									body.filter(i => i.dateOut.includes("2014")).length,
									body.filter(i => i.dateOut.includes("2015")).length,
									body.filter(i => i.dateOut.includes("2016")).length,
									body.filter(i => i.dateOut.includes("2017")).length,
									body.filter(i => i.dateOut.includes("2018")).length,
									body.filter(i => i.dateOut.includes("2019")).length,
									body.filter(i => i.dateOut.includes("2020")).length,
									body.filter(i => i.dateOut.includes("2021")).length,
									body.filter(i => i.dateOut.includes("2022")).length,
									body.filter(i => i.dateOut.includes("2023")).length
								]
							}
						]
					},
					options: {
						plugins: {
							title: {
								display: true,
								text: 'По кол-ву внесений/исключений'
							},
						}
					}
				})
			})
		</script>
	</body>
</html>
